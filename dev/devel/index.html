<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Developer Docs · ACE.jl Documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ACE.jl Documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../intro/">Introduction</a></li><li><a class="tocitem" href="../gettingstarted/">Getting Started</a></li><li class="is-active"><a class="tocitem" href>Developer Docs</a><ul class="internal"><li><a class="tocitem" href="#General-Notes"><span>General Notes</span></a></li><li><a class="tocitem" href="#Types-and-type-hierarchy"><span>Types and type hierarchy</span></a></li><li><a class="tocitem" href="#One-Particle-Basis"><span>One Particle Basis</span></a></li><li><a class="tocitem" href="#Permutation-Invariant-Basis"><span>Permutation-Invariant Basis</span></a></li><li><a class="tocitem" href="#Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse"><span>Generating a <code>OneParticleBasis</code> and <code>PIBasis</code> via <code>gen_sparse</code></span></a></li><li><a class="tocitem" href="#Derived-Potentials"><span>Derived Potentials</span></a></li><li><a class="tocitem" href="#RPI-Basis-(ACE-and-Extensions)"><span>RPI Basis (ACE and Extensions)</span></a></li><li><a class="tocitem" href="#Bond-Environment-Potentials"><span>Bond-Environment Potentials</span></a></li></ul></li><li><a class="tocitem" href="../envpairbasis/">ED-Bonds</a></li><li><span class="tocitem">Pure ACE</span><ul><li><a class="tocitem" href="../pureintro/">What is Pure ACE</a></li><li><a class="tocitem" href="../purerecursion/">Pure Basis Recursion</a></li><li><a class="tocitem" href="../polyproducts/">Products of Polynomials</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Developer Docs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Developer Docs</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ACEsuit/ACE.jl/blob/master/docs/src/devel.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Developer-Documentation"><a class="docs-heading-anchor" href="#Developer-Documentation">Developer Documentation</a><a id="Developer-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Developer-Documentation" title="Permalink"></a></h1><div class="admonition is-warning"><header class="admonition-header">WARNING</header><div class="admonition-body"><p>This documentation described what will be implemented on the <code>rewrite</code> branch, and not what is currently implemented!</p></div></div><h2 id="General-Notes"><a class="docs-heading-anchor" href="#General-Notes">General Notes</a><a id="General-Notes-1"></a><a class="docs-heading-anchor-permalink" href="#General-Notes" title="Permalink"></a></h2><ul><li>Always use <code>Int</code> for indexing, never <code>Int16, Int32</code>, etc.</li><li>There is a lot of switching between a species given by an <code>AtomicNumber</code> type and the index of that species in a list, given by an <code>Int</code>. Functions dispatch on <code>Int</code> vs <code>AtomicNumber</code> to make sure there is no confusion.</li></ul><h2 id="Types-and-type-hierarchy"><a class="docs-heading-anchor" href="#Types-and-type-hierarchy">Types and type hierarchy</a><a id="Types-and-type-hierarchy-1"></a><a class="docs-heading-anchor-permalink" href="#Types-and-type-hierarchy" title="Permalink"></a></h2><p>The <code>ACE.jl</code> package heavily utilizes composition (as opposed to inheritance), which is well aligned with Julia&#39;s type system and recommended style. Basis sets and calculators are built from the following two base types:</p><ul><li><code>OneParticleBasis</code> : abstract supertype of a 1-particle basis</li><li><code>PIBasis</code> : concrete implementation of a permutation-invariant basis</li></ul><p>For example, a rotation-invariant site energy basis set (ACE and extensions) <code>RPIBasis</code> is built from a <code>PIBasis</code> and the coupling coefficients. The <code>PIBasis</code> itself is specified in terms of the <code>OneParticleBasis</code>.</p><h2 id="One-Particle-Basis"><a class="docs-heading-anchor" href="#One-Particle-Basis">One Particle Basis</a><a id="One-Particle-Basis-1"></a><a class="docs-heading-anchor-permalink" href="#One-Particle-Basis" title="Permalink"></a></h2><p>A one-particle basis is a basis of functions <span>$\phi_k : \mathbb{R}^3 \to \mathbb{R}$</span> defined through a subtype of</p><pre><code class="language-julia">abstract type OneParticleBasis end</code></pre><p>Concrete subtypes must be able to compute the projection of the atom density onto the one-particle basis:</p><p class="math-container">\[  A_{k}^{z z_0}( \{ ({\bm r}_j, z_j) \}_{j = 1}^J, z_0 )
   = \sum_{j : z_j = z} \phi_k^{z_j z_0}({\bm r}_j),\]</p><p>where <span>$z_0$</span> is the atom number of the centre-atom, and <span>$({\bm r}_j, z_j)$</span> are relative positions and atom numbers of neighbours.</p><p>The &quot;standard&quot; evaluation of a single <span>$\phi_k({\bm r}; z, z_0)$</span> is of course a special case. In addition, the gradients of individual basis functions, <span>$\nabla \phi_k({\bm r}; z, z_0)$</span> must be provided; this gradient is taken with respect to <span>${\bm r}$</span>.</p><p>Assuming that <code>basis isa OneParticleBasis</code>, this is done with the following interface:</p><pre><code class="language-julia">A = alloc_B(basis)                # allocate storage for A = [ A_z for iz=1:NZ ]
tmp = alloc_temp(basis, args...)        # allocate temporary arrays
evaluate!(A, tmp, basis, Rs, Zs, z0)    # fill A = [ A_z for iz=1:NZ ]</code></pre><p>For the gradients the following must be provided:</p><pre><code class="language-julia">dPhi = alloc_dB(basis)                     # storage for (∇ϕ_k)_k
tmpd = alloc_temp_d(basis, args...)        # temporary storage
evaluate_d!(dPhi, tmpd, basis, R, z, z0)   # fill dPhi with (∇ϕ_k)_k</code></pre><p>The interface does not require <code>evaluate_d!(dPhi, tmpd, basis, Rs, Zs, z0)</code>.</p><p>There is a lot of code duplication in the implementation of <code>OneParticleBasis</code>, which we can avoid by a generic implementation of <code>evaluate!</code> which loops through all <code>(R, z) in zip(Rs, Zs)</code> and then calls</p><pre><code class="language-julia">add_into_A!(A[iz], tmp, basis, R, iz, iz0)</code></pre><p>an implementation of <code>OneParticleBasis</code> then only needs to overload <code>add_into_A!</code> which should evaluate <span>$\phi_k^{z z_0}({\bm r})$</span> (where <code>R</code> represents <span>${\bm r}$</span>) and <em>add</em> these values into <code>A[k]</code>. For this to work, the type of the 1-particle basis must contain a field <code>zlist</code> which implements the interface defined by <code>JuLIP.Potentials.ZList</code> and <code>JuLIP.Potentials.SZList</code>.</p><p>To build a <code>PIBasis</code> (see below) the <code>OneParticleBasis</code> musts also provide methods that specify it:</p><pre><code class="language-none">get_basis_spec(basis::BasicPSH1pBasis, z0::AtomicNumber)
get_basis_spec(basis::BasicPSH1pBasis, z0::AtomicNumber, i::Integer)</code></pre><p>The first of these should return a <code>Vector</code> containing <code>OnepBasisFcn</code> objects that specify the list of 1-particle basis functions for a centre atom of species <code>z0</code>. The second method should return precisely the ith element of this vector. A concrete <code>OneParticleBasis</code> may either simply keep these specifications stored throughout its lifetime, or generate them on the fly, whichever is most convenient.</p><div class="admonition is-info"><header class="admonition-header">Concrete subtypes of `OneParticleBasis`</header><div class="admonition-body"><p>Concrete subtypes of <code>OneParticleBasis</code> are</p><ul><li><code>BasicPSH1PBasis</code> : implemented and tested</li><li><code>PSH1PBasis</code> : parameterised version of <code>BasicPSH1Basis</code>; under construction</li><li><code>BondEnv1PBasis</code> : implemented in old code, needs to be ported</li><li><code>Tensor1PBasis</code> : not yet done</li></ul><p>Should revisit this and maybe add another abstract layer in-between since all of these are really tensor product bases! (Reference relevant sections below)</p></div></div><h2 id="Permutation-Invariant-Basis"><a class="docs-heading-anchor" href="#Permutation-Invariant-Basis">Permutation-Invariant Basis</a><a id="Permutation-Invariant-Basis-1"></a><a class="docs-heading-anchor-permalink" href="#Permutation-Invariant-Basis" title="Permalink"></a></h2><p>The permutation-invariant basis is a <em>concrete</em> type</p><pre><code class="language-julia">struct PIBasis end</code></pre><p>which implements the tensor-product like basis functions</p><p class="math-container">\[   {\bm A}_{\bm z \bm k}^{z_0}
   =
   \prod_{\alpha = 1}^N A_{k_\alpha}^{z_\alpha z_0},
   \qquad \text{where} \quad
   {\bm z} \in \mathbb{Z}^N, {\bm k} \in \mathbb{N}^N\]</p><p>as well as the gradients</p><p class="math-container">\[   \frac{\partial A_{\bm z \bm k}^{z_0}}{\partial {\bm r}_j}\]</p><p>The interface for this is as follows:</p><pre><code class="language-julia">alloc_B(pibasis::PIBasis)
alloc_tmp(pibasis::PIBasis)
evaluate!(AA, tmp, pibasis, Rs, Zs, z0)
alloc_dB(pibasis::PIBasis)
alloc_tmp_d(pibasis::PIBasis)
evaluate_d!(dAA, tmp, pibasis, Rs, Zs, z0)</code></pre><p>where the storage arrays are</p><ul><li><code>AA::Vector{&lt;: Number}</code> : to store any AA_kk^{zz, z0} with z0 fixed, i.e. the AA vector for a single site only. To use a PIBasis as the <em>actual</em> basis rather than an auxiliary one should wrap it (see bonds – TODO!)</li><li><code>dAA::Matrix{&lt;: JVec}</code> with dimension basis-length x number of particles</li></ul><p>We don&#39;t provide a detailed description here of the implementation, since it is already the final product. But we can summarize the functionality that is provided that can be used to construct further basis sets from it.</p><p>TODO</p><h2 id="Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse"><a class="docs-heading-anchor" href="#Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse">Generating a <code>OneParticleBasis</code> and <code>PIBasis</code> via <code>gen_sparse</code></a><a id="Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse" title="Permalink"></a></h2><p>TODO</p><h2 id="Derived-Potentials"><a class="docs-heading-anchor" href="#Derived-Potentials">Derived Potentials</a><a id="Derived-Potentials-1"></a><a class="docs-heading-anchor-permalink" href="#Derived-Potentials" title="Permalink"></a></h2><h2 id="RPI-Basis-(ACE-and-Extensions)"><a class="docs-heading-anchor" href="#RPI-Basis-(ACE-and-Extensions)">RPI Basis (ACE and Extensions)</a><a id="RPI-Basis-(ACE-and-Extensions)-1"></a><a class="docs-heading-anchor-permalink" href="#RPI-Basis-(ACE-and-Extensions)" title="Permalink"></a></h2><p>The ACE basis (Atomic Cluster Expansion; Drautz 2019) and its modifications and extensions is one of the main user-facing objects provided by <code>ACE.jl</code>. It is constructed by reducing a permutation invariant <code>PIBasis</code> to a permutation and rotation invariant basis through a single sparse matrix-vector multiplication.</p><p class="math-container">\[ B = C \cdot {\bm A},\]</p><p>where <span>$B$</span> is the new RPI basis, <span>${\bm A}$</span> the &quot;inner&quot; PI basis and <span>$C$</span> the coupling coefficients that achieve the rotation-invariance. This relies on a specific choice of the one-particle basis. This construction is outlined in (Atomic Cluster Expansion; Drautz 2019) and an extended derivation with full details in (Bachmayr, Drautz, Dusson, Etter, Van der Oort, Csanyi, Ortner, arXiv:19..). The implementation of the <span>$C$</span> coefficients in <code>rpi/rotations3d.jl</code> is based on a numerical SVD as opposed to an analytic SVD.</p><p>The <code>RPIBasis</code> type stores only three fields: the <code>PIBasis</code>, the coefficients <span>$C$</span>, and some index management to map the local site basis into a global basis (only needed for multiple species).</p><p>TODO: discuss the classes of 1-particle bases that are allowed.</p><h2 id="Bond-Environment-Potentials"><a class="docs-heading-anchor" href="#Bond-Environment-Potentials">Bond-Environment Potentials</a><a id="Bond-Environment-Potentials-1"></a><a class="docs-heading-anchor-permalink" href="#Bond-Environment-Potentials" title="Permalink"></a></h2></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gettingstarted/">« Getting Started</a><a class="docs-footer-nextpage" href="../envpairbasis/">ED-Bonds »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 3 December 2020 10:44">Thursday 3 December 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
