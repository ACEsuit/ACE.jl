<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Developer Docs · ACE.jl Documentation</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ACE.jl Documentation</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../intro/">Introduction</a></li><li><a class="tocitem" href="../gettingstarted/">Getting Started</a></li><li class="is-active"><a class="tocitem" href>Developer Docs</a><ul class="internal"><li><a class="tocitem" href="#Summary-of-types-and-type-hierarchy"><span>Summary of types and type hierarchy</span></a></li><li><a class="tocitem" href="#States-(Input-variables)"><span>States (Input variables)</span></a></li><li><a class="tocitem" href="#One-Particle-Basis"><span>One Particle Basis</span></a></li><li><a class="tocitem" href="#Permutation-Invariant-Basis"><span>Permutation-Invariant Basis</span></a></li><li><a class="tocitem" href="#Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse"><span>Generating a <code>OneParticleBasis</code> and <code>PIBasis</code> via <code>gen_sparse</code></span></a></li><li><a class="tocitem" href="#Properties-and-symmetries"><span>Properties and symmetries</span></a></li><li><a class="tocitem" href="#The-symmetric-basis"><span>The symmetric basis</span></a></li></ul></li><li><span class="tocitem">Pure ACE</span><ul><li><a class="tocitem" href="../pureintro/">What is Pure ACE</a></li><li><a class="tocitem" href="../purerecursion/">Pure Basis Recursion</a></li><li><a class="tocitem" href="../polyproducts/">Products of Polynomials</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Developer Docs</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Developer Docs</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ACEsuit/ACE.jl/blob/master/docs/src/devel.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Developer-Documentation"><a class="docs-heading-anchor" href="#Developer-Documentation">Developer Documentation</a><a id="Developer-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Developer-Documentation" title="Permalink"></a></h1><div class="admonition is-warning"><header class="admonition-header">WARNING</header><div class="admonition-body"><p>This documentation describes what will be implemented on the <code>rewrite</code> branch, and not what is currently implemented!</p></div></div><h2 id="Summary-of-types-and-type-hierarchy"><a class="docs-heading-anchor" href="#Summary-of-types-and-type-hierarchy">Summary of types and type hierarchy</a><a id="Summary-of-types-and-type-hierarchy-1"></a><a class="docs-heading-anchor-permalink" href="#Summary-of-types-and-type-hierarchy" title="Permalink"></a></h2><p>The <code>ACE.jl</code> package heavily utilizes composition (as opposed to inheritance), which is well aligned with Julia&#39;s type system and recommended style. Basis sets and calculators are built from the following two base types:</p><ul><li><code>OneParticleBasis</code> : abstract supertype of a 1-particle basis</li><li><code>PIBasis</code> : concrete implementation of a permutation-invariant basis, employing a <code>OneParticleBasis</code> and a specification of all possible correlations</li><li><code>SymmetricBasis</code> : implementation of the &quot;coupling&quot; to achieve O(3) symmetries</li></ul><p>TODO: this section could be expanded significantly</p><h2 id="States-(Input-variables)"><a class="docs-heading-anchor" href="#States-(Input-variables)">States (Input variables)</a><a id="States-(Input-variables)-1"></a><a class="docs-heading-anchor-permalink" href="#States-(Input-variables)" title="Permalink"></a></h2><p>Each particle is described by one or more variables, including e.g. its position, species, etc. The input space <span>$\mathbb{X}$</span> is simply the space in which those variables reside. The input variable must be a subtype <code>AbstractState</code> following some strict conventions.</p><h4 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h4><p>The original ACE models interatomic interaction with each state describing one atom in terms of its (relative) position and species. In this case the state could be defined as follow:</p><pre><code class="language-julia hljs">struct AtomState{T} &lt;: AbstractState
   mu::AtomicNumber
   rr::SVector{3, T}
end</code></pre><p>It is crucial that the properties <code>mu, rr</code> are known to the one-particle basis, i.e. when evaluating <span>$\phi_v(X)$</span> the one-particle basis <span>$\phi_v$</span> must &quot;know&quot; that it can obtain the position by calling <code>X.rr</code>.</p><h2 id="One-Particle-Basis"><a class="docs-heading-anchor" href="#One-Particle-Basis">One Particle Basis</a><a id="One-Particle-Basis-1"></a><a class="docs-heading-anchor-permalink" href="#One-Particle-Basis" title="Permalink"></a></h2><p>A one-particle basis is a basis of functions <span>$\phi_v : \mathbb{X} \to \mathbb{C}$</span> (or, <span>$\mathbb{R}$</span>) defined through a subtype of</p><pre><code class="language-julia hljs">abstract type OneParticleBasis end</code></pre><p>Concrete subtypes must implement the projection of the atom density onto the one-particle basis:</p><p class="math-container">\[  A_{v}( \{ X_j \}_{j \neq i}; X_i )
   = \sum_{j} \phi_v(X_i, X_j),\]</p><p>where including the centre-atom <span>$X_i$</span> in the argument allows us to compute relative positions, and incorporate centre-atom information into the basis. For example, this can be used to construct a different radial basis for all species pairs, incorporating information such as atomic radii. The &quot;standard&quot; evaluation of a single <span>$\phi_v(X; X_0)$</span> is of course a special case. In addition, the gradients of individual basis functions, <span>$\nabla \phi_v(X; X_0)$</span> must be provided; this gradient may be taken with respect to all continuous variables.</p><p>Assuming that <code>basis1p isa OneParticleBasis</code>, this is done with the following interface:</p><pre><code class="language-julia hljs">A = alloc_B(basis1p)               # allocate storage for A = [ A_z for iz=1:NZ ]
tmp = alloc_temp(basis1p, args...)    # allocate temporary arrays
evaluate!(A, tmp, basis1p, Xs, X0)    # fill A = [ A_z for iz=1:NZ ]</code></pre><div class="admonition is-warning"><header class="admonition-header">WARNING</header><div class="admonition-body"><p>The gradient interface is not really done yet and needs some design work!</p></div></div><p>For the gradients the following must be provided:</p><pre><code class="language-julia hljs">dPhi = alloc_dB(basis1p)                     # storage for (∇ϕ_k)_k
tmpd = alloc_temp_d(basis1p, args...)        # temporary storage
evaluate_d!(dPhi, tmpd, basis1p, X, X0)   # fill dPhi with (∇ϕ_k)_k</code></pre><p>The interface does not require <code>evaluate_d!(dPhi, tmpd, basis1p, Xs, X0)</code>.</p><p>There is a lot of code duplication in the implementation of <code>OneParticleBasis</code>, which we can avoid by a generic implementation of <code>evaluate!</code> which loops through all <code>X in Xs</code> and then calls</p><pre><code class="language-julia hljs">add_into_A!(A, tmp, basis1p, X, X0)</code></pre><p>an implementation of <code>OneParticleBasis</code> then only needs to overload <code>add_into_A!</code> which evaluates all <span>$\phi_v$</span> at one state pair <code>(X, X0)</code> and adds the basis values into a pre-allocated vector <code>A</code>.</p><p>The most common situation is that <code>basis1p</code> is a product of basis functions acting on different variables. This can be constructed using <code>Product1pBasis</code>. For example, a one-particle basis of the kind</p><p class="math-container">\[   \phi_{\mu n l m}(X) = \delta(\mu_X - \mu) R_n(r_X) Y_l^m({\bm r}_X)\]</p><p>can be constructed as</p><pre><code class="language-julia hljs">Bμ = Species1PBasisCtr(species)
Rn = Rn1pBasis(ACE.Utils.radial_basis())
Ylm = Ylm1pBasis(10)
basis1p = Product1pBasis( (Bμ, Rn, Ylm) )</code></pre><p>To build a <code>PIBasis</code> (see below) the <code>OneParticleBasis</code> musts also provide methods that specify it:</p><pre><code class="nohighlight hljs">get_spec(basis, i::Integer)   # specification of the ith basis function
get_spec(basis)               # vector containing all basis function specs</code></pre><p>A basis function is specified as a <code>NamedTuple</code>. For instance, in the above example the values of the <span>$\mu, n, l, m$</span> indices would specify <span>$\phi_{\mu n l m}$</span>. Thus the basis function is specified by</p><pre><code class="language-julia hljs">   b = (μ = ..., n = ..., l = ..., m = ...)</code></pre><p>This framework is particularly useful if some tuples overlap across different components of a product one-particle basis. For example, if <span>$R_n$</span> depends also on the species, or if the radial basis is given as <span>$R_{nl}$</span>.</p><p>To let the generic code know which indices are available and what the range of each index is the one-particle basis must implement <code>symbols</code> and <code>indexrange</code>.</p><h3 id="Concrete-Implementations-of-One-particle-Bases"><a class="docs-heading-anchor" href="#Concrete-Implementations-of-One-particle-Bases">Concrete Implementations of One-particle Bases</a><a id="Concrete-Implementations-of-One-particle-Bases-1"></a><a class="docs-heading-anchor-permalink" href="#Concrete-Implementations-of-One-particle-Bases" title="Permalink"></a></h3><div class="admonition is-info"><header class="admonition-header">TODO</header><div class="admonition-body"><p>Provide a list of all 1p-basis implementations to build from</p></div></div><h2 id="Permutation-Invariant-Basis"><a class="docs-heading-anchor" href="#Permutation-Invariant-Basis">Permutation-Invariant Basis</a><a id="Permutation-Invariant-Basis-1"></a><a class="docs-heading-anchor-permalink" href="#Permutation-Invariant-Basis" title="Permalink"></a></h2><p>The permutation-invariant basis is a <em>concrete</em> type</p><pre><code class="language-julia hljs">struct PIBasis end</code></pre><p>which implements the tensor-product like basis functions</p><p class="math-container">\[   {\bm A}_{\bm z \bm k}^{z_0}
   =
   \prod_{\alpha = 1}^N A_{k_\alpha}^{z_\alpha z_0},
   \qquad \text{where} \quad
   {\bm z} \in \mathbb{Z}^N, {\bm k} \in \mathbb{N}^N\]</p><p>as well as the gradients</p><p class="math-container">\[   \frac{\partial A_{\bm z \bm k}^{z_0}}{\partial {\bm r}_j}\]</p><p>The interface for this is as follows:</p><pre><code class="language-julia hljs">alloc_B(pibasis::PIBasis)
alloc_tmp(pibasis::PIBasis)
evaluate!(AA, tmp, pibasis, Rs, Zs, z0)
alloc_dB(pibasis::PIBasis)
alloc_tmp_d(pibasis::PIBasis)
evaluate_d!(dAA, tmp, pibasis, Rs, Zs, z0)</code></pre><p>where the storage arrays are</p><ul><li><code>AA::Vector{&lt;: Number}</code> : to store any AA_kk^{zz, z0} with z0 fixed, i.e. the AA vector for a single site only. To use a PIBasis as the <em>actual</em> basis rather than an auxiliary one should wrap it (see bonds – TODO!)</li><li><code>dAA::Matrix{&lt;: JVec}</code> with dimension basis-length x number of particles</li></ul><p>We don&#39;t provide a detailed description here of the implementation, since it is already the final product. But we can summarize the functionality that is provided that can be used to construct further basis sets from it.</p><h2 id="Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse"><a class="docs-heading-anchor" href="#Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse">Generating a <code>OneParticleBasis</code> and <code>PIBasis</code> via <code>gen_sparse</code></a><a id="Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse-1"></a><a class="docs-heading-anchor-permalink" href="#Generating-a-OneParticleBasis-and-PIBasis-via-gen_sparse" title="Permalink"></a></h2><p>!!! note TODO       explain how the basis sets are generated, and what options there are,       discuss what a degree is etc.</p><h2 id="Properties-and-symmetries"><a class="docs-heading-anchor" href="#Properties-and-symmetries">Properties and symmetries</a><a id="Properties-and-symmetries-1"></a><a class="docs-heading-anchor-permalink" href="#Properties-and-symmetries" title="Permalink"></a></h2><p>A property <span>$\varphi$</span> is the output of an ACE model. Each property has certain symmetries attached to it. For example, an invariant <span>$\varphi$</span> satisfies</p><p class="math-container">\[   \varphi \circ Q = \varphi\]</p><p>An equivariant Euclidean vector <span>$\varphi \in \mathbb{R}^3$</span> satisfies</p><p class="math-container">\[   \varphi \circ Q = Q \varphi.\]</p><p>An equi-variant spherical vector <span>$\varphi$</span> satisfies,</p><p class="math-container">\[   \varphi \circ Q = D(Q) \varphi.\]</p><p>and there are many more options as we move to higher-order tensors.</p><p>To model these symmetries we introduce the <code>SymmetricBasis</code> in the next section. To generate it a property must specify what its symmetries are.</p><p>All properties must be subtypes of <code>AbstractProperty</code>. For example</p><p class="math-container">\[struct Invariant{T} &lt;: AbstractProperty
   val::T
end\]</p><p>The actual value(s) should always be encoded in the field <code>val</code> since this allows for generic implementation of several methods required for properties, such as arithmetic operations.</p><div class="admonition is-info"><header class="admonition-header">TODO</header><div class="admonition-body"><p>discuss the interface how the properties specify their symmetry</p></div></div><h2 id="The-symmetric-basis"><a class="docs-heading-anchor" href="#The-symmetric-basis">The symmetric basis</a><a id="The-symmetric-basis-1"></a><a class="docs-heading-anchor-permalink" href="#The-symmetric-basis" title="Permalink"></a></h2><p>A key aspect of <code>ACE.jl</code> is to treat permutation symmetry <em>AND</em> O(3) symmetries. Given a propert <span>$\varphi$</span> which has certain symmetries attached to it we want to generate a basis <span>$\mathbf{B}$</span> which respects these symmetries as well. In <code>ACE.jl</code> this is provided by the <code>SymmetricBasis</code> type, which transforms from the density correlation basis <span>$\mathbf{A}$</span> to a symmetry adapted variant by computing all possible couplings of the spherical harmonics that produce the desired symmetry.</p><p class="math-container">\[ {\bm B} = C \cdot {\bm A}.\]</p><p>Note this relies on a specific choice of the one-particle basis; see references. The implementation of the <span>$C$</span> coefficients in <code>rotations3d.jl</code> is based on a numerical SVD as opposed to an analytic SVD.</p><p>The <code>RPIBasis</code> type stores only two fields: the <code>PIBasis</code> and the coefficients <span>$C$</span>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gettingstarted/">« Getting Started</a><a class="docs-footer-nextpage" href="../pureintro/">What is Pure ACE »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Friday 13 August 2021 02:18">Friday 13 August 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
